<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Torre del M.A.S. - Prof. V√≠ctor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap');
        
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #f0f4f8;
            overflow: hidden;
        }

        .block-animate {
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .fall-down {
            animation: fall 0.8s forwards;
        }

        @keyframes fall {
            to { transform: translateY(800px) rotate(25deg); opacity: 0; }
        }

        .gradient-physics {
            background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%);
            box-shadow: inset -4px -4px 0px rgba(0,0,0,0.1), 4px 4px 10px rgba(0,0,0,0.2);
        }

        .progress-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #cbd5e1;
        }
        .progress-dot.active {
            background-color: #2563eb;
            border-color: #2563eb;
        }

        #timer-bar {
            transition: width 1s linear, background-color 0.5s ease;
        }

        .overlay {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-slate-50 h-screen flex flex-col">

    <!-- Pantalla de Inicio -->
    <div id="login-screen" class="fixed inset-0 z-[100] overlay flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl text-center border-t-8 border-blue-600">
            <h1 class="text-3xl font-bold text-blue-700 mb-2">La Torre del M.A.S.</h1>
            <p class="text-slate-500 mb-6 text-sm italic">Desaf√≠o de Movimiento Arm√≥nico Simple</p>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">Estudiante</label>
                    <input type="text" id="player-name" placeholder="Tu nombre" class="w-full p-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none transition">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-400 uppercase mb-1 ml-1">Grado / Equipo</label>
                    <input type="text" id="team-name" placeholder="Ej: 11-A / Equipo Newton" class="w-full p-3 border-2 border-slate-200 rounded-xl focus:border-blue-500 outline-none transition">
                </div>
                <button onclick="startGame()" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg transition transform hover:scale-[1.02]">
                    ¬°Iniciar Laboratorio!
                </button>
            </div>
        </div>
    </div>

    <!-- Pantalla Final -->
    <div id="final-screen" class="fixed inset-0 z-[110] overlay hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 max-w-lg w-full shadow-2xl text-center overflow-y-auto max-h-[90vh]">
            <div id="final-icon" class="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"></div>
            <h2 id="final-title" class="text-3xl font-bold text-slate-800 mb-2"></h2>
            
            <div class="bg-slate-50 rounded-2xl p-6 text-left space-y-3 border border-slate-100 mb-6">
                <div class="flex justify-between border-b border-slate-200 pb-2">
                    <span class="text-slate-400 font-medium">Estudiante:</span>
                    <span id="res-identity" class="font-bold text-slate-700"></span>
                </div>
                <div class="flex justify-between border-b border-slate-200 pb-2">
                    <span class="text-slate-400 font-medium">Inicio:</span>
                    <span id="res-start" class="font-medium text-slate-600"></span>
                </div>
                <div class="flex justify-between border-b border-slate-200 pb-2">
                    <span class="text-slate-400 font-medium">Fin:</span>
                    <span id="res-end" class="font-medium text-slate-600"></span>
                </div>
                <div class="flex justify-between border-b border-slate-200 pb-2 bg-blue-50 p-2 rounded-lg">
                    <span class="text-blue-400 font-bold uppercase text-[10px]">Duraci√≥n Total:</span>
                    <span id="res-duration" class="font-bold text-blue-700"></span>
                </div>
                <div class="flex justify-between border-b border-slate-200 pb-2">
                    <span class="text-slate-400 font-medium">Bloques Apilados:</span>
                    <span id="res-blocks" class="font-bold text-green-600"></span>
                </div>
                <div class="flex justify-between border-b border-slate-200 pb-2">
                    <span class="text-slate-400 font-medium">Derrumbes:</span>
                    <span id="res-fails" class="font-bold text-red-600"></span>
                </div>
                <div class="flex justify-between text-lg pt-2">
                    <span class="text-blue-600 font-bold">Puntaje Final:</span>
                    <span id="res-score" class="font-black text-blue-700 text-2xl"></span>
                </div>
            </div>
            
            <button onclick="location.reload()" class="w-full py-3 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-900 transition mb-2">Reiniciar</button>
            <p class="text-slate-400 text-xs italic">Reporte de F√≠sica - Sistema Prof. V√≠ctor</p>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-blue-700 text-white p-3 shadow-lg flex justify-between items-center z-50">
        <div class="flex items-center gap-4">
            <div>
                <h1 class="text-xl font-bold leading-none mb-1">La Torre del M.A.S.</h1>
                <p class="text-[10px] opacity-80">Prof. V√≠ctor - Laboratorio Visual</p>
            </div>
            <div id="level-display" class="bg-blue-900 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider">Nivel 1</div>
        </div>
        <div class="text-right">
            <span class="text-[10px] uppercase opacity-70 block">Puntaje</span>
            <span id="score" class="text-xl font-black">0</span>
        </div>
    </header>

    <!-- Timer Bar -->
    <div class="w-full h-2 bg-slate-300 overflow-hidden">
        <div id="timer-bar" class="h-full bg-green-500 w-full"></div>
    </div>

    <!-- Main Game Area -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Torre Visual -->
        <section class="w-1/2 bg-slate-100 relative flex flex-col items-center justify-end p-8 border-r border-slate-200">
            <div class="absolute top-6 left-1/2 transform -translate-x-1/2 flex flex-col items-center bg-white/80 backdrop-blur-sm p-4 rounded-2xl shadow-sm z-10">
                <span class="text-slate-400 font-bold uppercase text-[10px] mb-2 tracking-widest">Estabilidad F√≠sica</span>
                <div id="progress-container" class="flex gap-2">
                    <div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div><div class="progress-dot"></div>
                </div>
            </div>

            <div id="tower-container" class="flex flex-col-reverse items-center w-full max-w-sm space-y-reverse space-y-2 mb-4">
                <div class="w-full h-6 bg-slate-800 rounded-t-lg shadow-xl relative"></div>
            </div>

            <div id="feedback" class="absolute top-1/2 transform -translate-y-1/2 opacity-0 transition-all duration-300 bg-red-600 text-white px-8 py-4 rounded-3xl font-bold shadow-2xl z-50 text-center pointer-events-none">
                <span id="feedback-msg" class="text-lg">¬°ERROR DE F√çSICA!</span>
            </div>
        </section>

        <!-- Inventario -->
        <section class="w-1/2 flex flex-col p-4 space-y-4 overflow-hidden">
            <div class="bg-white rounded-2xl p-4 shadow-sm border-l-4 border-blue-500">
                <h3 class="font-bold text-slate-800 text-sm mb-1">Instrucciones</h3>
                <p id="instruction-text" class="text-xs text-slate-500"></p>
            </div>

            <div class="flex-1 bg-slate-200/50 rounded-2xl p-4 flex flex-col min-h-0">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-slate-700 text-sm">Postulados y F√≥rmulas</h3>
                    <span id="blocks-left" class="text-[10px] bg-slate-300 text-slate-600 px-2 py-1 rounded-full font-bold"></span>
                </div>
                <div id="blocks-inventory" class="flex-1 overflow-y-auto space-y-2 pr-2"></div>
            </div>
            
            <div class="bg-white rounded-2xl p-4 shadow-sm border border-blue-50 flex justify-between">
                <div>
                    <h4 class="text-[10px] font-bold text-blue-400 uppercase">Estudiante</h4>
                    <p class="text-sm font-bold truncate" id="info-current-player">-</p>
                </div>
                <div class="text-right">
                    <h4 class="text-[10px] font-bold text-blue-400 uppercase">Equipo</h4>
                    <p class="text-xs font-medium" id="info-current-team">-</p>
                </div>
            </div>
        </section>
    </main>

    <script>
        let currentLevel = 1;
        let score = 0;
        let towerBlocksCount = 0;
        let playerName = "", teamName = "";
        let totalBlocksStacked = 0, totalFailures = 0;
        let timeLeft = 120, timerInterval = null;
        let currentLevelPool = [];
        
        let startTime = null;
        let endTime = null;

        const database = {
            level1: [
                // VERDADEROS (10)
                { text: "El Periodo (T) se mide en segundos", val: true },
                { text: "La Frecuencia es el n√∫mero de ciclos por segundo", val: true },
                { text: "En el punto de equilibrio, la velocidad es m√°xima", val: true },
                { text: "La Amplitud es la distancia m√°xima al centro", val: true },
                { text: "En los extremos, la aceleraci√≥n es m√°xima", val: true },
                { text: "La aceleraci√≥n en el punto medio es nula", val: true },
                { text: "La fuerza recuperadora va hacia el equilibrio", val: true },
                { text: "Elongaci√≥n es la posici√≥n en cualquier instante", val: true },
                { text: "Un ciclo es una oscilaci√≥n completa", val: true },
                { text: "El periodo es el inverso de la frecuencia", val: true },
                // FALSOS (10)
                { text: "En los extremos, la velocidad es m√°xima", val: false },
                { text: "Un p√©ndulo simple NO es un M.A.S.", val: false },
                { text: "A mayor masa, menor inercia", val: false },
                { text: "La gravedad afecta el periodo de un resorte", val: false },
                { text: "La amplitud disminuye en un M.A.S. ideal", val: false },
                { text: "La frecuencia aumenta si el periodo aumenta", val: false },
                { text: "En el equilibrio, la aceleraci√≥n es m√°xima", val: false },
                { text: "La elongaci√≥n siempre es mayor que la amplitud", val: false },
                { text: "La fuerza de restituci√≥n es constante", val: false },
                { text: "El periodo se mide en Hertz", val: false }
            ],
            level2: [
                // VERDADEROS (10)
                { text: "F = -k ¬∑ x (Ley de Hooke)", val: true },
                { text: "œâ = 2œÄ / T", val: true },
                { text: "Vmax = œâ ¬∑ A", val: true },
                { text: "amax = œâ¬≤ ¬∑ A", val: true },
                { text: "m = k / œâ¬≤", val: true },
                { text: "x = A ¬∑ cos(œât)", val: true },
                { text: "œâ = 2œÄ ¬∑ f", val: true },
                { text: "k = œâ¬≤ ¬∑ m", val: true },
                { text: "a = -œâ¬≤ ¬∑ x", val: true },
                { text: "f = 1 / T", val: true },
                // FALSOS (10)
                { text: "k = m / œâ¬≤", val: false },
                { text: "Vmax = A / T", val: false },
                { text: "F = k / x", val: false },
                { text: "œâ = 2œÄ ¬∑ T", val: false },
                { text: "amax = œâ ¬∑ A¬≤", val: false },
                { text: "x = A ¬∑ sen(t)", val: false },
                { text: "T = 2œÄ ‚àö(k/m)", val: false }, // Invertido, es m/k
                { text: "m = k ¬∑ œâ¬≤", val: false },
                { text: "V = œâ ¬∑ A ¬∑ cos(œât)", val: false },
                { text: "f = T / 1", val: false }
            ]
        };

        function startGame() {
            playerName = document.getElementById('player-name').value.trim();
            teamName = document.getElementById('team-name').value.trim();
            if (!playerName || !teamName) return alert("Completa los datos");
            
            startTime = new Date();
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('info-current-player').innerText = playerName;
            document.getElementById('info-current-team').innerText = teamName;
            initLevel();
        }

        function initLevel() {
            towerBlocksCount = 0;
            updateProgress();
            startTimer();
            const instr = document.getElementById('instruction-text');
            const levelText = document.getElementById('level-display');

            if (currentLevel === 1) {
                levelText.innerText = "Nivel 1: Conceptos";
                instr.innerText = "Apila 5 bloques con definiciones correctas del M.A.S. ¬°Cuidado con los distractores!";
                currentLevelPool = [...database.level1].sort(() => Math.random() - 0.5);
            } else {
                levelText.innerText = "Nivel 2: F√≥rmulas";
                instr.innerText = "Selecciona las ecuaciones y despejes correctos. Un signo mal puesto y la torre caer√°.";
                currentLevelPool = [...database.level2].sort(() => Math.random() - 0.5);
            }
            renderInventory();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120;
            timerInterval = setInterval(() => {
                timeLeft--;
                const percentage = (timeLeft / 120) * 100;
                const bar = document.getElementById('timer-bar');
                bar.style.width = percentage + "%";
                if (timeLeft <= 0) { clearInterval(timerInterval); finishGame(false); }
            }, 1000);
        }

        function renderInventory() {
            const inventory = document.getElementById('blocks-inventory');
            const counter = document.getElementById('blocks-left');
            inventory.innerHTML = '';
            
            // Mostrar solo 10 bloques a la vez
            const visibleBlocks = currentLevelPool.slice(0, 10);
            counter.innerText = `BANCO: ${currentLevelPool.length}`;

            visibleBlocks.forEach((item, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full p-3 bg-white border-2 border-slate-200 rounded-2xl shadow-sm hover:border-blue-400 text-sm font-semibold text-slate-700 text-left block-animate active:scale-95";
                btn.innerText = item.text;
                btn.onclick = () => checkBlock(item, idx);
                inventory.appendChild(btn);
            });
        }

        function checkBlock(item, idx) {
            if (item.val) {
                totalBlocksStacked++;
                towerBlocksCount++;
                score += (10 * currentLevel);
                addBlockToTower(item.text);
                
                // Remover el bloque correcto usado
                currentLevelPool.splice(idx, 1);
                
                updateProgress();
                renderInventory();
                document.getElementById('score').innerText = score;

                if (towerBlocksCount >= 5) {
                    clearInterval(timerInterval);
                    setTimeout(() => {
                        if (currentLevel === 1) {
                            alert("¬°Excelente base conceptual! Vamos a las f√≥rmulas.");
                            currentLevel = 2;
                            resetTower();
                            initLevel();
                        } else { finishGame(true); }
                    }, 600);
                }
            } else { 
                failTower();
                // Al fallar, barajamos el pool para que los bloques cambien de posici√≥n
                currentLevelPool = currentLevelPool.sort(() => Math.random() - 0.5);
                renderInventory();
            }
        }

        function addBlockToTower(txt) {
            const container = document.getElementById('tower-container');
            const b = document.createElement('div');
            b.className = "w-full p-4 gradient-physics text-white rounded-2xl text-center font-bold text-xs block-animate shadow-lg";
            b.innerText = txt;
            b.style.transform = "translateY(-50px)";
            b.style.opacity = "0";
            container.appendChild(b);
            setTimeout(() => { b.style.transform = "translateY(0)"; b.style.opacity = "1"; }, 50);
        }

        function failTower() {
            totalFailures++;
            const f = document.getElementById('feedback');
            const c = document.getElementById('tower-container');
            f.style.opacity = "1";
            c.classList.add('shake');
            
            c.querySelectorAll('.gradient-physics').forEach((b, i) => {
                setTimeout(() => b.classList.add('fall-down'), i * 100);
            });

            setTimeout(() => {
                f.style.opacity = "0";
                c.classList.remove('shake');
                resetTower();
                towerBlocksCount = 0;
                updateProgress();
            }, 1500);
        }

        function resetTower() {
            document.getElementById('tower-container').innerHTML = '<div class="w-full h-6 bg-slate-800 rounded-t-lg shadow-xl relative"></div>';
        }

        function updateProgress() {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, i) => {
                if (i < towerBlocksCount) dot.classList.add('active');
                else dot.classList.remove('active');
            });
        }

        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function finishGame(isVictory) {
            endTime = new Date();
            const diffMs = endTime - startTime;
            const diffMin = Math.floor(diffMs / 60000);
            const diffSec = Math.floor((diffMs % 60000) / 1000);

            document.getElementById('final-screen').classList.remove('hidden');
            const icon = document.getElementById('final-icon');
            const title = document.getElementById('final-title');
            
            if (isVictory) {
                icon.className = "w-20 h-20 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4";
                icon.innerHTML = "üèÜ"; title.innerText = "¬°Ingeniero del M.A.S.!";
            } else {
                icon.className = "w-20 h-20 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4";
                icon.innerHTML = "‚è±Ô∏è"; title.innerText = "Tiempo Agotado";
            }

            document.getElementById('res-identity').innerText = playerName + " (" + teamName + ")";
            document.getElementById('res-start').innerText = formatTime(startTime);
            document.getElementById('res-end').innerText = formatTime(endTime);
            document.getElementById('res-duration').innerText = `${diffMin}m ${diffSec}s`;
            
            document.getElementById('res-blocks').innerText = totalBlocksStacked;
            document.getElementById('res-fails').innerText = totalFailures;
            document.getElementById('res-score').innerText = score + " pts";
        }
    </script>
</body>
</html>